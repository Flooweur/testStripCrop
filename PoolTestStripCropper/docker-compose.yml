# =============================================================================
# Docker Compose Configuration
# =============================================================================
# This file provides an easy way to build and run the Pool Test Strip Cropper
# microservice using Docker Compose.
#
# Usage:
#   Build and start: docker-compose up --build
#   Start in background: docker-compose up -d
#   Stop: docker-compose down
#   View logs: docker-compose logs -f
# =============================================================================

version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # Pool Test Strip Cropper Service
  # ---------------------------------------------------------------------------
  pool-test-strip-cropper:
    # Build configuration
    build:
      context: .
      dockerfile: Dockerfile
    
    # Container name for easy reference
    container_name: pool-test-strip-cropper
    
    # Port mapping: host:container
    # Access the API at http://localhost:8080
    ports:
      - "8080:8080"
    
    # Volume mappings
    volumes:
      # Mount the output directory to persist cropped images
      # This allows you to access the cropped images from the host machine
      - ./output:/app/output
    
    # Environment variables
    environment:
      # Set the ASP.NET Core environment
      - ASPNETCORE_ENVIRONMENT=Production
      # Configure the output directory (inside the container)
      - OutputDirectory=/app/output
    
    # Restart policy: always restart unless explicitly stopped
    restart: unless-stopped
    
    # Health check configuration
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    
    # Resource limits (optional, uncomment to use)
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '1'
    #       memory: 512M
    #     reservations:
    #       cpus: '0.25'
    #       memory: 256M

# Optional: Define a named volume for persistent storage
# Uncomment if you prefer named volumes over bind mounts
# volumes:
#   output-data:
